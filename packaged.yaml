AWSTemplateFormatVersion: '2010-09-09'
Description: example-ws-api-gateway
Outputs:
  PushResponseFunctionArn:
    Description: Push Response Function ARN.
    Value:
      Fn::GetAtt:
      - PushResponseFunction
      - Arn
  SubmitLongRunningProcessFunctionArn:
    Description: Submit Long Running Function ARN
    Value:
      Fn::GetAtt:
      - SubmitLongRunningProcessFunction
      - Arn
Resources:
  PushResponseFunction:
    Description: Push to client the results of the long running process asynchronously
    Properties:
      CodeUri: s3://dsandor-blog-examples/716f8f8ab88c4bba93c9f219ee2bcfdf
      Events:
        DealSavedSnsTopic:
          Properties:
            Topic:
              Ref: longRunningProcessSnsTopic
          Type: SNS
      Handler: push-result.handler
      MemorySize: 256
      Policies:
      - AWSLambdaExecute
      - AmazonAPIGatewayInvokeFullAccess
      Runtime: nodejs8.10
    Type: AWS::Serverless::Function
  SubmitLongRunningProcessFunction:
    Description: Submits a long running process for event based processing.
    Properties:
      CodeUri: s3://dsandor-blog-examples/716f8f8ab88c4bba93c9f219ee2bcfdf
      Environment:
        Variables:
          LONG_RUNNING_PROCESS_SNS_TOPIC:
            Ref: longRunningProcessSnsTopic
      Handler: submit-long-running-process.handler
      MemorySize: 256
      Policies:
      - AmazonSNSFullAccess
      - AWSLambdaExecute
      Runtime: nodejs8.10
    Type: AWS::Serverless::Function
  longRunningProcessSnsTopic:
    Properties:
      DisplayName: example-long-running-proc-topic
    Type: AWS::SNS::Topic
Transform: AWS::Serverless-2016-10-31
